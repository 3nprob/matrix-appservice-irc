Refactor room creation code to use one function for tracking and creation of rooms